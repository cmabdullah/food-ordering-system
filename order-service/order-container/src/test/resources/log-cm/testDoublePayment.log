2023-03-14 20:38:48.159  INFO 2533 --- [-consumer-2-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:38:48.159  INFO 2533 --- [-consumer-1-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:38:48.159  INFO 2533 --- [-consumer-2-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:38:48.160  INFO 2533 --- [-consumer-0-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:38:48.161  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:38:48.161  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:38:48.161  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:38:48.165  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.165  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.165  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.163  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:38:48.159  INFO 2533 --- [-consumer-0-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:38:48.168  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.168  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:38:48.159  INFO 2533 --- [-consumer-1-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:38:48.171  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:38:48.170  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.174  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.201  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:38:48.201  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:38:48.201  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:38:48.202  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.202  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.202  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.211  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Successfully joined group with generation Generation{generationId=3, memberId='consumer-payment-topic-consumer-5-47133a1c-639d-4b56-b549-08a091d00ffd', protocol='range'}
2023-03-14 20:38:48.212  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Successfully joined group with generation Generation{generationId=3, memberId='consumer-payment-topic-consumer-6-f7d7a088-1f49-44b2-b7e3-d70c7227acd0', protocol='range'}
2023-03-14 20:38:48.212  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Successfully joined group with generation Generation{generationId=4, memberId='consumer-restaurant-approval-topic-consumer-3-63841e4d-369c-4b5d-be39-b2f41caf8aea', protocol='range'}
2023-03-14 20:38:48.216  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Finished assignment for group at generation 4: {consumer-restaurant-approval-topic-consumer-3-63841e4d-369c-4b5d-be39-b2f41caf8aea=Assignment(partitions=[restaurant-approval-response-0])}
2023-03-14 20:38:48.216  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Finished assignment for group at generation 3: {consumer-payment-topic-consumer-5-47133a1c-639d-4b56-b549-08a091d00ffd=Assignment(partitions=[payment-response-0]), consumer-payment-topic-consumer-6-f7d7a088-1f49-44b2-b7e3-d70c7227acd0=Assignment(partitions=[])}
2023-03-14 20:38:48.220  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:38:48.223  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.231  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Successfully synced group in generation Generation{generationId=4, memberId='consumer-restaurant-approval-topic-consumer-3-63841e4d-369c-4b5d-be39-b2f41caf8aea', protocol='range'}
2023-03-14 20:38:48.231  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Successfully synced group in generation Generation{generationId=3, memberId='consumer-payment-topic-consumer-5-47133a1c-639d-4b56-b549-08a091d00ffd', protocol='range'}
2023-03-14 20:38:48.233  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Notifying assignor about the new Assignment(partitions=[restaurant-approval-response-0])
2023-03-14 20:38:48.233  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Notifying assignor about the new Assignment(partitions=[payment-response-0])
2023-03-14 20:38:48.236  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Successfully synced group in generation Generation{generationId=3, memberId='consumer-payment-topic-consumer-6-f7d7a088-1f49-44b2-b7e3-d70c7227acd0', protocol='range'}
2023-03-14 20:38:48.237  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Notifying assignor about the new Assignment(partitions=[])
2023-03-14 20:38:48.238  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Adding newly assigned partitions:
2023-03-14 20:38:48.239  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Adding newly assigned partitions: payment-response-0
2023-03-14 20:38:48.239  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Adding newly assigned partitions: restaurant-approval-response-0
2023-03-14 20:38:48.240  INFO 2533 --- [-consumer-2-C-1] o.s.k.l.KafkaMessageListenerContainer    : payment-topic-consumer: partitions assigned: []
2023-03-14 20:38:48.251  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Found no committed offset for partition payment-response-0
2023-03-14 20:38:48.251  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Found no committed offset for partition restaurant-approval-response-0
2023-03-14 20:38:48.256  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:38:48.257  INFO 2533 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.260  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:38:48.262  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:38:48.270  INFO 2533 --- [-consumer-1-C-1] o.a.k.c.c.internals.SubscriptionState    : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Resetting offset for partition payment-response-0 to position FetchPosition{offset=0, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch{leader=Optional[192.168.0.6:9092 (id: 0 rack: null)], epoch=0}}.
2023-03-14 20:38:48.270  INFO 2533 --- [-consumer-2-C-1] o.a.k.c.c.internals.SubscriptionState    : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Resetting offset for partition restaurant-approval-response-0 to position FetchPosition{offset=0, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch{leader=Optional[192.168.0.6:9092 (id: 0 rack: null)], epoch=0}}.
2023-03-14 20:38:48.272  INFO 2533 --- [-consumer-2-C-1] o.s.k.l.KafkaMessageListenerContainer    : restaurant-approval-topic-consumer: partitions assigned: [restaurant-approval-response-0]
2023-03-14 20:38:48.272  INFO 2533 --- [-consumer-1-C-1] o.s.k.l.KafkaMessageListenerContainer    : payment-topic-consumer: partitions assigned: [payment-response-0]
Hibernate: select paymentout0_.id as id1_5_, paymentout0_.created_at as created_2_5_, paymentout0_.order_status as order_st3_5_, paymentout0_.outbox_status as outbox_s4_5_, paymentout0_.payload as payload5_5_, paymentout0_.processed_at as processe6_5_, paymentout0_.saga_id as saga_id7_5_, paymentout0_.saga_status as saga_sta8_5_, paymentout0_.type as type9_5_, paymentout0_.version as version10_5_ from payment_outbox paymentout0_ where paymentout0_.type=? and paymentout0_.saga_id=? and (paymentout0_.saga_status in (?))
2023-03-14 20:38:48.986  INFO 2533 --- [           main] c.f.o.s.o.s.domain.OrderPaymentSaga      : Completing payment for order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17
Hibernate: select orderentit0_.id as id1_4_0_, orderentit0_.customer_id as customer2_4_0_, orderentit0_.failure_messages as failure_3_4_0_, orderentit0_.order_status as order_st4_4_0_, orderentit0_.price as price5_4_0_, orderentit0_.restaurant_id as restaura6_4_0_, orderentit0_.tracking_id as tracking7_4_0_, orderaddre1_.id as id1_2_1_, orderaddre1_.city as city2_2_1_, orderaddre1_.order_id as order_id5_2_1_, orderaddre1_.postal_code as postal_c3_2_1_, orderaddre1_.street as street4_2_1_ from orders orderentit0_ left outer join order_address orderaddre1_ on orderentit0_.id=orderaddre1_.order_id where orderentit0_.id=?
Hibernate: select items0_.order_id as order_id6_3_0_, items0_.id as id1_3_0_, items0_.id as id1_3_1_, items0_.order_id as order_id6_3_1_, items0_.price as price2_3_1_, items0_.product_id as product_3_3_1_, items0_.quantity as quantity4_3_1_, items0_.sub_total as sub_tota5_3_1_ from order_items items0_ where items0_.order_id=?
2023-03-14 20:38:49.088  INFO 2533 --- [           main] c.f.o.s.o.s.d.s.OrderDomainServiceImpl   : Order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17 is paid
2023-03-14 20:38:49.152  INFO 2533 --- [           main] c.f.o.s.o.s.d.o.s.p.PaymentOutboxHelper  : OrderPaymentOutboxMessage saved with outbox id: 8904808e-286f-449b-9b56-b63ba8351cf2
Hibernate: select approvalou0_.id as id1_6_0_, approvalou0_.created_at as created_2_6_0_, approvalou0_.order_status as order_st3_6_0_, approvalou0_.outbox_status as outbox_s4_6_0_, approvalou0_.payload as payload5_6_0_, approvalou0_.processed_at as processe6_6_0_, approvalou0_.saga_id as saga_id7_6_0_, approvalou0_.saga_status as saga_sta8_6_0_, approvalou0_.type as type9_6_0_, approvalou0_.version as version10_6_0_ from restaurant_approval_outbox approvalou0_ where approvalou0_.id=?
2023-03-14 20:38:49.468  INFO 2533 --- [           main] c.f.o.s.o.s.d.o.s.a.ApprovalOutboxHelper : OrderApprovalOutboxMessage saved with outbox id: 4767893a-9692-4dbc-a781-465a5594ae29
2023-03-14 20:38:49.469  INFO 2533 --- [           main] c.f.o.s.o.s.domain.OrderPaymentSaga      : Order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17 is paid
Hibernate: insert into restaurant_approval_outbox (created_at, order_status, outbox_status, payload, processed_at, saga_id, saga_status, type, version, id) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
Hibernate: update payment_outbox set created_at=?, order_status=?, outbox_status=?, payload=?, processed_at=?, saga_id=?, saga_status=?, type=?, version=? where id=? and version=?
Hibernate: update orders set customer_id=?, failure_messages=?, order_status=?, price=?, restaurant_id=?, tracking_id=? where id=?
Hibernate: select paymentout0_.id as id1_5_, paymentout0_.created_at as created_2_5_, paymentout0_.order_status as order_st3_5_, paymentout0_.outbox_status as outbox_s4_5_, paymentout0_.payload as payload5_5_, paymentout0_.processed_at as processe6_5_, paymentout0_.saga_id as saga_id7_5_, paymentout0_.saga_status as saga_sta8_5_, paymentout0_.type as type9_5_, paymentout0_.version as version10_5_ from payment_outbox paymentout0_ where paymentout0_.type=? and paymentout0_.saga_id=? and (paymentout0_.saga_status in (?))
2023-03-14 20:38:49.599  INFO 2533 --- [           main] c.f.o.s.o.s.domain.OrderPaymentSaga      : An outbox message with saga id: 15a497c1-0f4b-4eff-b9f4-c402c8c07afa is already processed!
