2023-03-14 20:51:14.594  INFO 2595 --- [-consumer-1-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:51:14.595  INFO 2595 --- [-consumer-0-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:51:14.595  INFO 2595 --- [-consumer-2-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:51:14.596  INFO 2595 --- [-consumer-0-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:51:14.594  INFO 2595 --- [-consumer-2-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:51:14.597  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:51:14.597  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:51:14.598  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:51:14.598  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:51:14.598  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:51:14.600  INFO 2595 --- [-consumer-1-C-1] org.apache.kafka.clients.Metadata        : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Cluster ID: NLT3ZwnUQf2hyrkdW4MhjQ
2023-03-14 20:51:14.603  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.603  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.603  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.604  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.605  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.607  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Discovered group coordinator 192.168.0.6:9092 (id: 2147483647 rack: null)
2023-03-14 20:51:14.612  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.633  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:51:14.635  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:51:14.635  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.635  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.644  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Successfully joined group with generation Generation{generationId=4, memberId='consumer-payment-topic-consumer-6-5ca2fb3b-2f48-414a-a5f3-84261617b87d', protocol='range'}
2023-03-14 20:51:14.645  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:51:14.646  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.651  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Finished assignment for group at generation 4: {consumer-payment-topic-consumer-6-5ca2fb3b-2f48-414a-a5f3-84261617b87d=Assignment(partitions=[payment-response-0])}
2023-03-14 20:51:14.658  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Successfully joined group with generation Generation{generationId=4, memberId='consumer-restaurant-approval-topic-consumer-2-94ba286a-a42c-461c-9d0c-75df8bef0b47', protocol='range'}
2023-03-14 20:51:14.660  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Finished assignment for group at generation 4: {consumer-restaurant-approval-topic-consumer-2-94ba286a-a42c-461c-9d0c-75df8bef0b47=Assignment(partitions=[restaurant-approval-response-0])}
2023-03-14 20:51:14.661  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:51:14.661  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:51:14.662  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.662  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.666  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] SyncGroup failed: The group began another rebalance. Need to re-join the group. Sent generation was Generation{generationId=4, memberId='consumer-restaurant-approval-topic-consumer-2-94ba286a-a42c-461c-9d0c-75df8bef0b47', protocol='range'}
2023-03-14 20:51:14.666  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] SyncGroup failed: The group began another rebalance. Need to re-join the group. Sent generation was Generation{generationId=4, memberId='consumer-payment-topic-consumer-6-5ca2fb3b-2f48-414a-a5f3-84261617b87d', protocol='range'}
2023-03-14 20:51:14.666  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.666  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.669  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Successfully joined group with generation Generation{generationId=5, memberId='consumer-payment-topic-consumer-5-85480912-cfcc-4dcc-8658-c1539bd587b8', protocol='range'}
2023-03-14 20:51:14.669  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Successfully joined group with generation Generation{generationId=5, memberId='consumer-restaurant-approval-topic-consumer-1-1cb94afa-e77b-4f6e-bd3c-e5dd0fbbfb8f', protocol='range'}
2023-03-14 20:51:14.669  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Successfully joined group with generation Generation{generationId=5, memberId='consumer-payment-topic-consumer-6-5ca2fb3b-2f48-414a-a5f3-84261617b87d', protocol='range'}
2023-03-14 20:51:14.670  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Successfully joined group with generation Generation{generationId=5, memberId='consumer-restaurant-approval-topic-consumer-3-3e1a5488-d3b0-41b2-83dd-8bdb41a38a3f', protocol='range'}
2023-03-14 20:51:14.670  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Finished assignment for group at generation 5: {consumer-payment-topic-consumer-6-5ca2fb3b-2f48-414a-a5f3-84261617b87d=Assignment(partitions=[]), consumer-payment-topic-consumer-5-85480912-cfcc-4dcc-8658-c1539bd587b8=Assignment(partitions=[payment-response-0])}
2023-03-14 20:51:14.671  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Successfully joined group with generation Generation{generationId=5, memberId='consumer-restaurant-approval-topic-consumer-2-94ba286a-a42c-461c-9d0c-75df8bef0b47', protocol='range'}
2023-03-14 20:51:14.672  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Finished assignment for group at generation 5: {consumer-restaurant-approval-topic-consumer-3-3e1a5488-d3b0-41b2-83dd-8bdb41a38a3f=Assignment(partitions=[]), consumer-restaurant-approval-topic-consumer-2-94ba286a-a42c-461c-9d0c-75df8bef0b47=Assignment(partitions=[]), consumer-restaurant-approval-topic-consumer-1-1cb94afa-e77b-4f6e-bd3c-e5dd0fbbfb8f=Assignment(partitions=[restaurant-approval-response-0])}
2023-03-14 20:51:14.674  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Successfully synced group in generation Generation{generationId=5, memberId='consumer-payment-topic-consumer-6-5ca2fb3b-2f48-414a-a5f3-84261617b87d', protocol='range'}
2023-03-14 20:51:14.675  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Successfully synced group in generation Generation{generationId=5, memberId='consumer-payment-topic-consumer-5-85480912-cfcc-4dcc-8658-c1539bd587b8', protocol='range'}
2023-03-14 20:51:14.676  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Successfully synced group in generation Generation{generationId=5, memberId='consumer-restaurant-approval-topic-consumer-1-1cb94afa-e77b-4f6e-bd3c-e5dd0fbbfb8f', protocol='range'}
2023-03-14 20:51:14.676  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Notifying assignor about the new Assignment(partitions=[])
2023-03-14 20:51:14.677  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Notifying assignor about the new Assignment(partitions=[restaurant-approval-response-0])
2023-03-14 20:51:14.682  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Successfully synced group in generation Generation{generationId=5, memberId='consumer-restaurant-approval-topic-consumer-3-3e1a5488-d3b0-41b2-83dd-8bdb41a38a3f', protocol='range'}
2023-03-14 20:51:14.683  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Notifying assignor about the new Assignment(partitions=[])
2023-03-14 20:51:14.684  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-3, groupId=restaurant-approval-topic-consumer] Adding newly assigned partitions:
2023-03-14 20:51:14.676  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Notifying assignor about the new Assignment(partitions=[payment-response-0])
2023-03-14 20:51:14.677  INFO 2595 --- [-consumer-2-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-6, groupId=payment-topic-consumer] Adding newly assigned partitions:
2023-03-14 20:51:14.684  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Successfully synced group in generation Generation{generationId=5, memberId='consumer-restaurant-approval-topic-consumer-2-94ba286a-a42c-461c-9d0c-75df8bef0b47', protocol='range'}
2023-03-14 20:51:14.689  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Notifying assignor about the new Assignment(partitions=[])
2023-03-14 20:51:14.691  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-2, groupId=restaurant-approval-topic-consumer] Adding newly assigned partitions:
2023-03-14 20:51:14.692  INFO 2595 --- [-consumer-1-C-1] o.s.k.l.KafkaMessageListenerContainer    : restaurant-approval-topic-consumer: partitions assigned: []
2023-03-14 20:51:14.692  INFO 2595 --- [-consumer-2-C-1] o.s.k.l.KafkaMessageListenerContainer    : payment-topic-consumer: partitions assigned: []
2023-03-14 20:51:14.692  INFO 2595 --- [-consumer-2-C-1] o.s.k.l.KafkaMessageListenerContainer    : restaurant-approval-topic-consumer: partitions assigned: []
2023-03-14 20:51:14.698  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Adding newly assigned partitions: restaurant-approval-response-0
2023-03-14 20:51:14.699  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Adding newly assigned partitions: payment-response-0
2023-03-14 20:51:14.705  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Found no committed offset for partition restaurant-approval-response-0
2023-03-14 20:51:14.707  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Found no committed offset for partition payment-response-0
2023-03-14 20:51:14.714  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] Request joining group due to: need to re-join with the given member-id
2023-03-14 20:51:14.715  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-payment-topic-consumer-4, groupId=payment-topic-consumer] (Re-)joining group
2023-03-14 20:51:14.726  INFO 2595 --- [-consumer-0-C-1] o.a.k.c.c.internals.SubscriptionState    : [Consumer clientId=consumer-restaurant-approval-topic-consumer-1, groupId=restaurant-approval-topic-consumer] Resetting offset for partition restaurant-approval-response-0 to position FetchPosition{offset=0, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch{leader=Optional[192.168.0.6:9092 (id: 0 rack: null)], epoch=0}}.
2023-03-14 20:51:14.726  INFO 2595 --- [-consumer-1-C-1] o.a.k.c.c.internals.SubscriptionState    : [Consumer clientId=consumer-payment-topic-consumer-5, groupId=payment-topic-consumer] Resetting offset for partition payment-response-0 to position FetchPosition{offset=0, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch{leader=Optional[192.168.0.6:9092 (id: 0 rack: null)], epoch=0}}.
2023-03-14 20:51:14.727  INFO 2595 --- [-consumer-1-C-1] o.s.k.l.KafkaMessageListenerContainer    : payment-topic-consumer: partitions assigned: [payment-response-0]
2023-03-14 20:51:14.727  INFO 2595 --- [-consumer-0-C-1] o.s.k.l.KafkaMessageListenerContainer    : restaurant-approval-topic-consumer: partitions assigned: [restaurant-approval-response-0]
Hibernate: select paymentout0_.id as id1_5_, paymentout0_.created_at as created_2_5_, paymentout0_.order_status as order_st3_5_, paymentout0_.outbox_status as outbox_s4_5_, paymentout0_.payload as payload5_5_, paymentout0_.processed_at as processe6_5_, paymentout0_.saga_id as saga_id7_5_, paymentout0_.saga_status as saga_sta8_5_, paymentout0_.type as type9_5_, paymentout0_.version as version10_5_ from payment_outbox paymentout0_ where paymentout0_.type=? and paymentout0_.saga_id=? and (paymentout0_.saga_status in (?))
Hibernate: select paymentout0_.id as id1_5_, paymentout0_.created_at as created_2_5_, paymentout0_.order_status as order_st3_5_, paymentout0_.outbox_status as outbox_s4_5_, paymentout0_.payload as payload5_5_, paymentout0_.processed_at as processe6_5_, paymentout0_.saga_id as saga_id7_5_, paymentout0_.saga_status as saga_sta8_5_, paymentout0_.type as type9_5_, paymentout0_.version as version10_5_ from payment_outbox paymentout0_ where paymentout0_.type=? and paymentout0_.saga_id=? and (paymentout0_.saga_status in (?))
2023-03-14 20:51:15.060  INFO 2595 --- [       Thread-1] c.f.o.s.o.s.domain.OrderPaymentSaga      : Completing payment for order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17
2023-03-14 20:51:15.061  INFO 2595 --- [       Thread-2] c.f.o.s.o.s.domain.OrderPaymentSaga      : Completing payment for order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17
Hibernate: select orderentit0_.id as id1_4_0_, orderentit0_.customer_id as customer2_4_0_, orderentit0_.failure_messages as failure_3_4_0_, orderentit0_.order_status as order_st4_4_0_, orderentit0_.price as price5_4_0_, orderentit0_.restaurant_id as restaura6_4_0_, orderentit0_.tracking_id as tracking7_4_0_, orderaddre1_.id as id1_2_1_, orderaddre1_.city as city2_2_1_, orderaddre1_.order_id as order_id5_2_1_, orderaddre1_.postal_code as postal_c3_2_1_, orderaddre1_.street as street4_2_1_ from orders orderentit0_ left outer join order_address orderaddre1_ on orderentit0_.id=orderaddre1_.order_id where orderentit0_.id=?
Hibernate: select orderentit0_.id as id1_4_0_, orderentit0_.customer_id as customer2_4_0_, orderentit0_.failure_messages as failure_3_4_0_, orderentit0_.order_status as order_st4_4_0_, orderentit0_.price as price5_4_0_, orderentit0_.restaurant_id as restaura6_4_0_, orderentit0_.tracking_id as tracking7_4_0_, orderaddre1_.id as id1_2_1_, orderaddre1_.city as city2_2_1_, orderaddre1_.order_id as order_id5_2_1_, orderaddre1_.postal_code as postal_c3_2_1_, orderaddre1_.street as street4_2_1_ from orders orderentit0_ left outer join order_address orderaddre1_ on orderentit0_.id=orderaddre1_.order_id where orderentit0_.id=?
Hibernate: select items0_.order_id as order_id6_3_0_, items0_.id as id1_3_0_, items0_.id as id1_3_1_, items0_.order_id as order_id6_3_1_, items0_.price as price2_3_1_, items0_.product_id as product_3_3_1_, items0_.quantity as quantity4_3_1_, items0_.sub_total as sub_tota5_3_1_ from order_items items0_ where items0_.order_id=?
Hibernate: select items0_.order_id as order_id6_3_0_, items0_.id as id1_3_0_, items0_.id as id1_3_1_, items0_.order_id as order_id6_3_1_, items0_.price as price2_3_1_, items0_.product_id as product_3_3_1_, items0_.quantity as quantity4_3_1_, items0_.sub_total as sub_tota5_3_1_ from order_items items0_ where items0_.order_id=?
2023-03-14 20:51:15.154  INFO 2595 --- [       Thread-1] c.f.o.s.o.s.d.s.OrderDomainServiceImpl   : Order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17 is paid
2023-03-14 20:51:15.154  INFO 2595 --- [       Thread-2] c.f.o.s.o.s.d.s.OrderDomainServiceImpl   : Order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17 is paid
2023-03-14 20:51:15.208  INFO 2595 --- [       Thread-1] c.f.o.s.o.s.d.o.s.p.PaymentOutboxHelper  : OrderPaymentOutboxMessage saved with outbox id: 8904808e-286f-449b-9b56-b63ba8351cf2
2023-03-14 20:51:15.209  INFO 2595 --- [       Thread-2] c.f.o.s.o.s.d.o.s.p.PaymentOutboxHelper  : OrderPaymentOutboxMessage saved with outbox id: 8904808e-286f-449b-9b56-b63ba8351cf2
Hibernate: select approvalou0_.id as id1_6_0_, approvalou0_.created_at as created_2_6_0_, approvalou0_.order_status as order_st3_6_0_, approvalou0_.outbox_status as outbox_s4_6_0_, approvalou0_.payload as payload5_6_0_, approvalou0_.processed_at as processe6_6_0_, approvalou0_.saga_id as saga_id7_6_0_, approvalou0_.saga_status as saga_sta8_6_0_, approvalou0_.type as type9_6_0_, approvalou0_.version as version10_6_0_ from restaurant_approval_outbox approvalou0_ where approvalou0_.id=?
Hibernate: select approvalou0_.id as id1_6_0_, approvalou0_.created_at as created_2_6_0_, approvalou0_.order_status as order_st3_6_0_, approvalou0_.outbox_status as outbox_s4_6_0_, approvalou0_.payload as payload5_6_0_, approvalou0_.processed_at as processe6_6_0_, approvalou0_.saga_id as saga_id7_6_0_, approvalou0_.saga_status as saga_sta8_6_0_, approvalou0_.type as type9_6_0_, approvalou0_.version as version10_6_0_ from restaurant_approval_outbox approvalou0_ where approvalou0_.id=?
2023-03-14 20:51:15.439  INFO 2595 --- [       Thread-1] c.f.o.s.o.s.d.o.s.a.ApprovalOutboxHelper : OrderApprovalOutboxMessage saved with outbox id: 90bc7c7f-9470-413e-a192-c696a4574179
2023-03-14 20:51:15.440  INFO 2595 --- [       Thread-1] c.f.o.s.o.s.domain.OrderPaymentSaga      : Order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17 is paid
2023-03-14 20:51:15.443  INFO 2595 --- [       Thread-2] c.f.o.s.o.s.d.o.s.a.ApprovalOutboxHelper : OrderApprovalOutboxMessage saved with outbox id: cdeb4337-11ff-43fe-b6e9-9467ce1965bc
2023-03-14 20:51:15.444  INFO 2595 --- [       Thread-2] c.f.o.s.o.s.domain.OrderPaymentSaga      : Order with id: d215b5f8-0249-4dc5-89a3-51fd148cfb17 is paid
Hibernate: insert into restaurant_approval_outbox (created_at, order_status, outbox_status, payload, processed_at, saga_id, saga_status, type, version, id) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
Hibernate: insert into restaurant_approval_outbox (created_at, order_status, outbox_status, payload, processed_at, saga_id, saga_status, type, version, id) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
Hibernate: update payment_outbox set created_at=?, order_status=?, outbox_status=?, payload=?, processed_at=?, saga_id=?, saga_status=?, type=?, version=? where id=? and version=?
Hibernate: update payment_outbox set created_at=?, order_status=?, outbox_status=?, payload=?, processed_at=?, saga_id=?, saga_status=?, type=?, version=? where id=? and version=?
Hibernate: update orders set customer_id=?, failure_messages=?, order_status=?, price=?, restaurant_id=?, tracking_id=? where id=?
2023-03-14 20:51:15.564  INFO 2595 --- [       Thread-1] o.h.e.j.b.internal.AbstractBatchImpl     : HHH000010: On release of batch it still contained JDBC statements
Exception in thread "Thread-1" org.springframework.orm.ObjectOptimisticLockingFailureException: Batch update returned unexpected row count from update [0]; actual row count: 0; expected: 1; statement executed: update payment_outbox set created_at=?, order_status=?, outbox_status=?, payload=?, processed_at=?, saga_id=?, saga_status=?, type=?, version=? where id=? and version=?; nested exception is org.hibernate.StaleStateException: Batch update returned unexpected row count from update [0]; actual row count: 0; expected: 1; statement executed: update payment_outbox set created_at=?, order_status=?, outbox_status=?, payload=?, processed_at=?, saga_id=?, saga_status=?, type=?, version=? where id=? and version=?
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:318)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:233)
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:566)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:743)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:711)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:654)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:407)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:753)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:698)
	at com.food.ordering.system.order.service.domain.OrderPaymentSaga$$EnhancerBySpringCGLIB$$8a321f31.process(<generated>)
	at com.food.ordering.system.order.service.domain.OrderPaymentSagaTest.lambda$testDoublePaymentWithThreads$0(OrderPaymentSagaTest.java:51)
	at java.base/java.lang.Thread.run(Thread.java:1589)
Caused by: org.hibernate.StaleStateException: Batch update returned unexpected row count from update [0]; actual row count: 0; expected: 1; statement executed: update payment_outbox set created_at=?, order_status=?, outbox_status=?, payload=?, processed_at=?, saga_id=?, saga_status=?, type=?, version=? where id=? and version=?
	at org.hibernate.jdbc.Expectations$BasicExpectation.checkBatched(Expectations.java:67)
	at org.hibernate.jdbc.Expectations$BasicExpectation.verifyOutcome(Expectations.java:54)
	at org.hibernate.engine.jdbc.batch.internal.NonBatchingBatch.addToBatch(NonBatchingBatch.java:47)
	at org.hibernate.persister.entity.AbstractEntityPersister.update(AbstractEntityPersister.java:3571)
	at org.hibernate.persister.entity.AbstractEntityPersister.updateOrInsert(AbstractEntityPersister.java:3438)
	at org.hibernate.persister.entity.AbstractEntityPersister.update(AbstractEntityPersister.java:3852)
	at org.hibernate.action.internal.EntityUpdateAction.execute(EntityUpdateAction.java:201)
	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:604)
	at org.hibernate.engine.spi.ActionQueue.lambda$executeActions$1(ActionQueue.java:478)
	at java.base/java.util.LinkedHashMap.forEach(LinkedHashMap.java:729)
	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:475)
	at org.hibernate.event.internal.AbstractFlushingEventListener.performExecutions(AbstractFlushingEventListener.java:344)
	at org.hibernate.event.internal.DefaultFlushEventListener.onFlush(DefaultFlushEventListener.java:40)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:107)
	at org.hibernate.internal.SessionImpl.doFlush(SessionImpl.java:1402)
	at org.hibernate.internal.SessionImpl.managedFlush(SessionImpl.java:493)
	at org.hibernate.internal.SessionImpl.flushBeforeTransactionCompletion(SessionImpl.java:3285)
	at org.hibernate.internal.SessionImpl.beforeTransactionCompletion(SessionImpl.java:2420)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.beforeTransactionCompletion(JdbcCoordinatorImpl.java:449)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl.beforeCompletionCallback(JdbcResourceLocalTransactionCoordinatorImpl.java:183)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl.access$300(JdbcResourceLocalTransactionCoordinatorImpl.java:40)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:281)
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101)
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:562)
	... 11 more
Hibernate: select paymentout0_.id as id1_5_, paymentout0_.created_at as created_2_5_, paymentout0_.order_status as order_st3_5_, paymentout0_.outbox_status as outbox_s4_5_, paymentout0_.payload as payload5_5_, paymentout0_.processed_at as processe6_5_, paymentout0_.saga_id as saga_id7_5_, paymentout0_.saga_status as saga_sta8_5_, paymentout0_.type as type9_5_, paymentout0_.version as version10_5_ from payment_outbox paymentout0_ where paymentout0_.type=? and paymentout0_.saga_id=? and (paymentout0_.saga_status in (?))
